#+TITLE: [What]ip 协议
#+DATE: <2019-10-18 五> 
#+TAGS: CS
#+LAYOUT: post
#+CATEGORIES: book,Linux高性能服务器编程
#+NAME: <book_linux_server_chapter_2.org>
#+OPTIONS: ^:nil
#+OPTIONS: ^:{}

在阅读 [[http://kcmetercec.top/categories/book/%25E5%259B%25BE%25E8%25A7%25A3TCPIP-%25E5%2585%25A5%25E9%2597%25A8/][<<图解TCPIP>>]] 时，只简单提了一下 ip，现在将它们加深一下理解。
#+BEGIN_EXPORT html
<!--more-->
#+END_EXPORT
* IP 服务的特点
IP 协议的特点是：
1. 无状态（stateless）：IP 数据报的发送、传输和接收都是相互独立的，没有上下文关系。
  - 也就是说接收端无法识别 IP 数据报的先后顺序，也无法区分是否接收到了重复的数据报，这些数据报交由上层协议处理
    + IP 报中的标识是用于分片和重组，无法区分多个完整数据报的先后顺序
2. 无连接（connectionless）：每次发送数据报都必须明确指定对方的 IP 地址
3. 不可靠：IP 协议不能保证 IP 数据报准确地到达接收端，这需要上层协议来处理
* 回顾 IPv4 头部
[[./ipv4_header.jpg]]

需要留意的是：
- 在 TOS 中的 4 位服务质量字段中，最多有 1 位能置 1
  + 像 ssh,telnet 这种服务就选最小延时，对 ftp 这样的服务就选最大吞吐量
- 同一个数据报的分片标识值都一样，不同的数据报标识值不同
- 3 位标志字段中，如果设置了“禁止分片”。如果 IP 数据报超过 MTU,则此包将会被丢弃并返回一个 ICMP 差错报文
  + 对于第 3 位，除了数据报最后一个分片外，其他分片都要把它置一
- 13 位分片偏移是数据部分的偏移，并且该值表示的是 8 的整数倍，也就是说 *除了最后一个 IP 分片外，其他分片数据长度必须是 8 的整数倍*
- 最后的可选字段可以作为：
  - 记录路由（record route）：将数据报途径的路由器的 IP 地址填入可选字段，跟踪数据传递路径
  - 时间戳（timestamp）：路由器将数据报被转发的时间填入可选字段，测量数据传输时间
  - 松散源路由选择（loose source routing）：指定路由器 IP 地址列表，数据报发送必须警告所有路由器
  - 严格源路由选择（stric source routing）：指定路由器 IP 地址列表，数据报发送 *只能* 经过所选路由
** 观察 IPv4 头部
